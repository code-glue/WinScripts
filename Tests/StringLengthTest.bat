@echo off

SetLocal DisableDelayedExpansion

set BatchFile=%~dp0..\StringLength.bat
pushd "%~dp0"
    
set Desc=ErrorLevel should be 1 for usage
verify>nul
if %ErrorLevel% neq 0 goto ExitFail
call "%BatchFile%" >nul
if %ErrorLevel% neq 1 goto ExitFail

set Desc=Empty string (variable)
verify ? 2>nul
call "%BatchFile%" "" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 0 goto ExitFail

set Desc=Space (variable)
verify ? 2>nul
call "%BatchFile%" " " Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 1 goto ExitFail

set Desc=Space+Tab (variable)
verify ? 2>nul
call "%BatchFile%" " 	" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 2 goto ExitFail

set Desc=Single letter (variable)
verify ? 2>nul
call "%BatchFile%" a Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 1 goto ExitFail

set Desc=Single letter (quoted) (variable)
verify ? 2>nul
call "%BatchFile%" "a" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 1 goto ExitFail

set Desc=Multiple letters (variable)
verify ? 2>nul
call "%BatchFile%" abc Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 3 goto ExitFail

set Desc=Multiple letters (quoted) (variable)
verify ? 2>nul
call "%BatchFile%" "abc" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 3 goto ExitFail

set Desc=Multiple letters with spaces (variable)
verify ? 2>nul
call "%BatchFile%" " a b c " Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 7 goto ExitFail

set Desc=Length 23 (variable)
verify ? 2>nul
call "%BatchFile%" "01234567890123456789012" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 23 goto ExitFail

set Desc=Length 1000 (variable)
verify ? 2>nul
call "%BatchFile%" "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 1000 goto ExitFail

set Desc=Length 8099 (variable)
verify ? 2>nul
call "%BatchFile%" "01234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123450123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 8099 goto ExitFail

set Desc=Symbols (variable)
verify ? 2>nul
call "%BatchFile%" "!`~@$*()-=_+{}[]\/?.,';:|<>&%%%%#" Actual
if %ErrorLevel% neq 0 goto ExitFail
if %Actual% neq 30 goto ExitFail

set Desc=ErrorLevel should be 0 for all inputs 
verify ? 2>nul
if %ErrorLevel% neq 1 goto ExitFail
call "%BatchFile%" "" >nul
if %ErrorLevel% neq 0 goto ExitFail

set Desc=Empty string (stdout)
for /f %%a in ('call "%BatchFile%" ""') do (set "Actual=%%a")
if %Actual% neq 0 goto ExitFail

set Desc=Space (stdout)
for /f %%a in ('call "%BatchFile%" " "') do (set "Actual=%%a")
if %Actual% neq 1 goto ExitFail

set Desc=Space+Tab (stdout)
for /f %%a in ('call "%BatchFile%" " 	"') do (set "Actual=%%a")
if %Actual% neq 2 goto ExitFail

set Desc=Single letter (stdout)
for /f %%a in ('call "%BatchFile%" a') do (set "Actual=%%a")
if %Actual% neq 1 goto ExitFail

set Desc=Single letter (quoted) (stdout)
for /f %%a in ('call "%BatchFile%" "a"') do (set "Actual=%%a")
if %Actual% neq 1 goto ExitFail

set Desc=Multiple letters (stdout)
for /f %%a in ('call "%BatchFile%" abc') do (set "Actual=%%a")
if %Actual% neq 3 goto ExitFail

set Desc=Multiple letters (quoted) (stdout)
for /f %%a in ('call "%BatchFile%" "abc"') do (set "Actual=%%a")
if %Actual% neq 3 goto ExitFail

set Desc=Multiple letters with spaces (stdout)
for /f %%a in ('call "%BatchFile%" " a b c "') do (set "Actual=%%a")
if %Actual% neq 7 goto ExitFail

set Desc=Length 23 (stdout)
for /f %%a in ('call "%BatchFile%" "01234567890123456789012"') do (set "Actual=%%a")
if %Actual% neq 23 goto ExitFail

set Desc=Length 1000 (stdout)
for /f %%a in ('call "%BatchFile%" "0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789"') do (set "Actual=%%a")
if %Actual% neq 1000 goto ExitFail

set Desc=Symbols (stdout)
for /f %%a in ('call "%BatchFile%" "!`~@$*()-=_+{}[]\/?.,';:|<>&%%#"') do set "Actual=%%a"
if %Actual% neq 30 goto ExitFail

echo.
echo All tests passed
goto Exit


:ExitFail
echo.
SetLocal EnableDelayedExpansion
echo Test failed: !Desc!
echo      Actual: !Actual!
EndLocal


:Exit
popd
call "%~dp0..\PauseGui.bat" "%~f0"
